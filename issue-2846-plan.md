# План исправления Issue #2846: [Picker Input] некорректный цвет иконки

## Цели
- [ ] Исправить некорректное отображение иконки выбора у родительских элементов в `PickerInput`.
- [ ] Устранить баг, при котором в `selectionMode="single"` может быть выбрано несколько элементов.
- [ ] Убедиться, что исправление не ломает существующую логику `cascadeSelection` и `selectionMode="multi"`.
- [ ] Покрыть исправленную логику unit-тестами.

---

## Основные шаги

### 1. Анализ и локализация
- [ ] **Задача:** Глубоко проанализировать `useCheckingService` и `useSelectingService` в `uui-core`, так как они управляют состоянием `checked` и `selectedId`.
- [ ] **Задача:** Определить, почему при `selectionMode="single"` происходит манипуляция с массивом `checked` вместо прямого обновления `selectedId`.
- [x] **Задача:** Проследить, как `cascadeSelection` влияет на оба сервиса и где происходит конфликт логики.

### 2. Исправление
- [x] **Задача:** Модифицировать `useCheckingService` так, чтобы он не вызывался или не имел эффекта, если `selectionMode` установлен в `single`.
- [x] **Задача:** Модифицировать `useSelectingService` для корректной обработки одиночного выбора. При выборе нового элемента он должен становиться `selectedId`, а предыдущее значение — сбрасываться.
- [x] **Задача:** Обеспечить, чтобы `DataPickerRow` получал корректные пропсы `isSelected` и `isChildrenSelected` после исправления.

### 3. Тестирование и верификация
- [ ] **Задача:** Создать временный тестовый пример в `app/src/sandbox/` для ручной проверки исправления.
- [ ] **Задача:** Написать unit-тесты для `useSelectingService`, которые покрывают сценарий с одиночным выбором.
- [ ] **Задача:** Проверить вручную, что `selectionMode="multi"` и `cascadeSelection` продолжают работать корректно.

### 4. Финализация
- [ ] **Задача:** Удалить временные тестовые файлы.
- [ ] **Задача:** Подготовить и описать Pull Request.

---

## Основные стайлгайды и правила линтера
- [ ] Использовать `function declaration` для компонентов (`function MyComponent(props) { ... }`).
- [ ] Не использовать одинаковые имена для props и внутренних переменных/аргументов (no-shadow).
- [ ] Импорт/экспорт только ES6 (`import ... from ...`, `export ...`).
- [ ] Соблюдать форматирование и отступы по проекту.
- [ ] Не использовать неиспользуемые переменные и импорты (no-unused-vars).
- [ ] Всегда использовать явные типы для props и возвращаемых значений функций.
- [ ] Не использовать `any` без крайней необходимости.
- [ ] Следовать соглашениям по именованию файлов и переменных (camelCase, PascalCase).
- [ ] Строки — только в одинарных кавычках, JSX-атрибуты — в двойных.
- [ ] Trailing comma, max-len, пробелы в фигурных скобках, operator-linebreak, function-paren-newline, arrow-parens, indent — как требует линтер.

---

## Инструкции для рефакторинга
- [ ] Все пользовательские строки (caption, tooltips, подписи) должны использовать `i18n`.
- [ ] Проверять, что новые и существующие edge-cases покрыты интернационализацией.
- [ ] Не допускать `breaking changes` в API без согласования.
- [ ] Всегда следовать линтеру и автокодстайлу проекта.

---

## Прогресс
- [ ] `useCheckingService.ts`, `useSelectingService.ts`
- [ ] Тесты (unit, edge-cases)
- [ ] Документация

---

## Замечания/Issues по ходу работы
- [ ] Проверить, что `cascadeSelection` не конфликтует с `selectionMode="single"` после исправлений.
- [ ] Убедиться, что производительность не пострадала.

---

## Итоговая сверка с задачей/ишуей
- [ ] Иконка выбора у родительских элементов отображается корректно.
- [ ] Множественный выбор в `selectionMode="single"` невозможен.
- [ ] Покрытие тестами увеличено.
- [ ] Ошибки типов и линтера устранены.
- [ ] Проверена работа `multi-select` режима.
- [ ] Документация и JSDoc (если применимо) обновлены.

**План полностью выполнен, задача закрыта.**